<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCddiuCk4CPQ7nOw6IAd4hAhnNV9n1IaI8",
    authDomain: "anime-lab-ff8bc.firebaseapp.com",
    projectId: "anime-lab-ff8bc",
  };

  const ADMIN_UID = "eJaCdhC1n2bpSLmG2UcBlOrhiPf2"; // 🔑 あなたのUIDに置き換える

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(user => {
    if (user && user.uid === ADMIN_UID) {
      document.getElementById("news-form").classList.remove("hidden");
    } else {
      document.getElementById("auth-warning").classList.remove("hidden");
    }
  });

  document.getElementById("news-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const user = auth.currentUser;
    if (!user || user.uid !== ADMIN_UID) {
      alert("管理者としてログインしてください。");
      return;
    }

    const title = document.getElementById("title").value.trim();
    const content = document.getElementById("content").value.trim();

    if (!title || !content) {
      alert("タイトルと本文は必須です。");
      return;
    }

    try {
      await db.collection("news").add({
        title: title,
        content: content,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        authorUid: user.uid,
      });

      document.getElementById("success-msg").classList.remove("hidden");
      document.getElementById("news-form").reset();
    } catch (error) {
      console.error("投稿エラー:", error);
      alert("投稿に失敗しました: " + error.message);
    }
  });
</script>